spack:
  definitions:
  - pkgs:
    - readline@7.0
  - compilers:
    - '%gcc@5.5.0'
    - '%gcc@7.3.0'
    - '%clang@6.0.0'
  - oses:
    - os=ubuntu18.04
    - os=centos7

  specs:
  - matrix:
    - [$pkgs]
    - [$compilers]
    - [$oses]
    exclude:
      - '%gcc@7.3.0 os=centos7'

  mirrors:
    cloud_gitlab: https://mirror.spack.io

  compilers:
    # The .gitlab-ci.yml for this project picks a Docker container which is
    # based on ubuntu18.04 and which already has some compilers configured.
    # Here we just add some of the ones which are defined on a different
    # builder image.
    - compiler:
        operating_system: centos7
        modules: []
        paths:
          cc: /not/used
          cxx: /not/used
          f77: /not/used
          fc: /not/used
        spec: gcc@5.5.0
        target: x86_64
    - compiler:
        operating_system: centos7
        modules: []
        paths:
          cc: /not/used
          cxx: /not/used
          f77: /not/used
          fc: /not/used
        spec: clang@6.0.0
        target: x86_64


  gitlab-ci:
    mappings:
      - spack-cloud-ubuntu:
        match:
          # these are specs, if *any* match the spec under consideration, this
          # 'mapping' will be used to generate the CI job
          - os=ubuntu18.04
        runner-attributes:
          # 'tags' and 'image' go directly onto the job, 'variables' will
          # be added to what we already necessarily create for the job as
          # a part of the CI workflow
          tags:
            - spack-k8s
          image: scottwittenburg/spack_builder_ubuntu_18.04
      - spack-cloud-centos:
        match:
          # these are specs, if *any* match the spec under consideration, this
          # 'mapping' will be used to generate the CI job
          - 'os=centos7'
        runner-attributes:
          tags:
            - spack-k8s
          image: spack/centos:7
      - summit:
        match:
          - os=rhel7
          - target=power9
          - platform=secret-sauce
        runner-attributes:
          tags:
            # this is a set of tags
            - summit
            - '{os}-{target}'
            - rhel7
            - centos7
            - x86_64
          variables:
            SCHEDULER_ARGS: "arg2 arg2"

  cdash:
    build-group: Release Testing
    url: https://cdash.spack.io
    project: Spack Testing
    site: Spack AWS Gitlab Instance

  repos: []
  upstreams: {}
  modules:
    enable: []
  packages: {}
  config: {}
